import{g as q,c as x}from"./sweetalert2.all--W2uxDSh.js";import{p as A,e as T,c as w}from"./swal-FXd2eKjy.js";import{_ as B,r as $,o as g,g as G,w as z,a as t,b as p,h as v,c as y,F as I,e as X,t as O,d as J}from"./index-gzh1gDBb.js";import{L as K}from"./LoadingOverlay-_dypeP48.js";var Q="Expected a function",R=NaN,Y="[object Symbol]",Z=/^\s+|\s+$/g,ee=/^[-+]0x[0-9a-f]+$/i,te=/^0b[01]+$/i,se=/^0o[0-7]+$/i,ae=parseInt,ne=typeof x=="object"&&x&&x.Object===Object&&x,oe=typeof self=="object"&&self&&self.Object===Object&&self,re=ne||oe||Function("return this")(),ie=Object.prototype,le=ie.toString,de=Math.max,ce=Math.min,k=function(){return re.Date.now()};function ue(e,s,r){var d,a,m,c,n,f,u=0,i=!1,l=!1,h=!0;if(typeof e!="function")throw new TypeError(Q);s=N(s)||0,j(r)&&(i=!!r.leading,l="maxWait"in r,m=l?de(N(r.maxWait)||0,s):m,h="trailing"in r?!!r.trailing:h);function C(o){var _=d,b=a;return d=a=void 0,u=o,c=e.apply(b,_),c}function H(o){return u=o,n=setTimeout(V,s),i?C(o):c}function M(o){var _=o-f,b=o-u,F=s-_;return l?ce(F,m-b):F}function P(o){var _=o-f,b=o-u;return f===void 0||_>=s||_<0||l&&b>=m}function V(){var o=k();if(P(o))return D(o);n=setTimeout(V,M(o))}function D(o){return n=void 0,h&&d?C(o):(d=a=void 0,c)}function U(){n!==void 0&&clearTimeout(n),u=0,d=f=a=n=void 0}function W(){return n===void 0?c:D(k())}function E(){var o=k(),_=P(o);if(d=arguments,a=this,f=o,_){if(n===void 0)return H(f);if(l)return n=setTimeout(V,s),C(f)}return n===void 0&&(n=setTimeout(V,s)),c}return E.cancel=U,E.flush=W,E}function j(e){var s=typeof e;return!!e&&(s=="object"||s=="function")}function me(e){return!!e&&typeof e=="object"}function fe(e){return typeof e=="symbol"||me(e)&&le.call(e)==Y}function N(e){if(typeof e=="number")return e;if(fe(e))return R;if(j(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=j(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=e.replace(Z,"");var r=te.test(e);return r||se.test(e)?ae(e.slice(2),r?2:8):ee.test(e)?R:+e}var pe=ue;const _e=q(pe);var he={VITE_API:"https://ec-course-api.hexschool.io",VITE_PATH:"eerovuelive",BASE_URL:"/HexSchool-2023Vue-Week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:ge,VITE_PATH:be}=he,ve={data(){return{data:{user:{}}}},methods:{postOrder(){this.$http.post(`${ge}/v2/api/${be}/order`,{data:this.data}).then(e=>{A(e.data.message),this.$refs.form.resetForm(),this.resetCart()}).catch(e=>{T(e.response.data.message)})},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"請輸入 09 開頭，包含後 8 碼"},resetCart(){this.$emit("reset-cart")}}},ye={class:"mb-3"},$e=t("label",{for:"email",class:"form-label"},"信箱",-1),Ve={class:"mb-3"},xe=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Oe={class:"mb-3"},Le=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Te={class:"mb-3"},Ce=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Ee={class:"mb-3"},Ie=t("label",{for:"message",class:"form-label"},"留言",-1),ke=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function Se(e,s,r,d,a,m){const c=$("VField"),n=$("ErrorMessage"),f=$("VForm");return g(),G(f,{class:"col-md-6",onSubmit:m.postOrder,ref:"form"},{default:z(({errors:u})=>[t("div",ye,[$e,p(c,{type:"email",id:"email",name:"信箱",class:v(["form-control",{"is-invalid":u.信箱}]),placeholder:"請輸入信箱",modelValue:a.data.user.email,"onUpdate:modelValue":s[0]||(s[0]=i=>a.data.user.email=i),rules:"required|email"},null,8,["modelValue","class"]),p(n,{name:"信箱",class:"invalid-feedback"})]),t("div",Ve,[xe,p(c,{type:"text",id:"name",name:"姓名",class:v(["form-control",{"is-invalid":u.姓名}]),placeholder:"請輸入姓名",modelValue:a.data.user.name,"onUpdate:modelValue":s[1]||(s[1]=i=>a.data.user.name=i),rules:"required"},null,8,["modelValue","class"]),p(n,{name:"姓名",class:"invalid-feedback"})]),t("div",Oe,[Le,p(c,{type:"tel",id:"tel",name:"電話",class:v(["form-control",{"is-invalid":u.電話}]),placeholder:"請輸入電話",modelValue:a.data.user.tel,"onUpdate:modelValue":s[2]||(s[2]=i=>a.data.user.tel=i),rules:m.isPhone},null,8,["modelValue","rules","class"]),p(n,{name:"電話",class:"invalid-feedback"})]),t("div",Te,[Ce,p(c,{type:"text",id:"address",name:"地址",class:v(["form-control",{"is-invalid":u.地址}]),placeholder:"請輸入地址",modelValue:a.data.user.address,"onUpdate:modelValue":s[3]||(s[3]=i=>a.data.user.address=i),rules:"required"},null,8,["modelValue","class"]),p(n,{name:"地址",class:"invalid-feedback"})]),t("div",Ee,[Ie,p(c,{type:"email",id:"message",name:"message",class:v(["form-control",{"is-invalid":u.message}]),placeholder:"有問題都可以留言~~",as:"textarea",rows:"5",modelValue:a.data.message,"onUpdate:modelValue":s[4]||(s[4]=i=>a.data.message=i)},null,8,["modelValue","class"]),p(n,{name:"message",class:"invalid-feedback"})]),ke]),_:1},8,["onSubmit"])}const Ae=B(ve,[["render",Se]]);var je={VITE_API:"https://ec-course-api.hexschool.io",VITE_PATH:"eerovuelive",BASE_URL:"/HexSchool-2023Vue-Week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:S,VITE_PATH:L}=je,Pe={data(){return{cartData:null}},methods:{getCart(){this.$refs.LoadingOverlay.isLoading=!0,this.$http.get(`${S}/v2/api/${L}/cart`).then(e=>{this.$refs.LoadingOverlay.isLoading=!1,this.cartData=e.data.data}).catch(e=>{this.$refs.LoadingOverlay.isLoading=!1,T(e.response.data.message)})},putCart:_e(function(e,s){this.$refs.LoadingOverlay.isLoading=!0;const r={product_id:e,qty:Number(s.target.value)};this.$http.put(`${S}/v2/api/${L}/cart/${e}`,{data:r}).then(d=>{this.$refs.LoadingOverlay.isLoading=!1,A(d.data.message),this.getCart()}).catch(d=>{this.$refs.LoadingOverlay.isLoading=!1,T(d.response.data.message)})},1e3),async deleteCart(e,s){const{isConfirmed:r}=await w(s);if(r){this.$refs.LoadingOverlay.isLoading=!0;const d=e?`/v2/api/${L}/cart/${e}`:`/v2/api/${L}/carts`;this.$http.delete(`${S}${d}`).then(a=>{A(a.data.message),this.getCart(),this.$refs.LoadingOverlay.isLoading=!1}).catch(a=>{T(a.response.data.message),this.$refs.LoadingOverlay.isLoading=!1})}}},mounted(){this.getCart()},components:{OrderForm:Ae,LoadingOverlayVue:K}},De={class:"container"},Fe={class:"text-end"},Re={class:"table align-middle"},Ne=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1),Be=["onClick"],He=t("i",{class:"fas fa-spinner fa-pulse"},null,-1),Me={class:"input-group input-group-sm"},Ue={class:"input-group mb-3"},We=["value","onInput"],qe={class:"input-group-text",id:"basic-addon2"},we={class:"text-end"},Ge=t("td",{colspan:"3",class:"text-end"},"總計",-1),ze={class:"text-end"},Xe={class:"my-5 row justify-content-center"},Je={key:1};function Ke(e,s,r,d,a,m){var f,u,i;const c=$("OrderForm"),n=$("LoadingOverlayVue");return g(),y(I,null,[t("div",De,[(f=a.cartData)!=null&&f.final_total?(g(),y(I,{key:0},[t("div",Fe,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=l=>m.deleteCart(null,"是否清空購物車"))}," 清空購物車 ")]),t("table",Re,[Ne,t("tbody",null,[(g(!0),y(I,null,X((u=a.cartData)==null?void 0:u.carts,l=>(g(),y("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>m.deleteCart(l.id,`是否刪除 ${l.product.title}`)},[He,J(" x ")],8,Be)]),t("td",null,[t("div",null,O(l.product.title),1)]),t("td",null,[t("div",Me,[t("div",Ue,[t("input",{min:"1",type:"number",class:"form-control",value:l.qty,onInput:h=>m.putCart(l.id,h)},null,40,We),t("span",qe,O(l.product.unit),1)])])]),t("td",we,O(l.total),1)]))),128))]),t("tfoot",null,[t("tr",null,[Ge,t("td",ze,O((i=a.cartData)==null?void 0:i.final_total),1)])])]),t("div",Xe,[p(c,{onResetCart:m.getCart},null,8,["onResetCart"])])],64)):(g(),y("h3",Je,"目前購物車無品項"))]),p(n,{ref:"LoadingOverlay"},null,512)],64)}const tt=B(Pe,[["render",Ke]]);export{tt as default};
